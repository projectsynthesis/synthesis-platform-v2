
import OpenAI from 'openai';

const openai = new OpenAI({
ย apiKey: process.env.OPENAI_API_KEY,
});

export default async function handler(req, res) {
ย // Allow CORS
ย res.setHeader('Access-Control-Allow-Credentials', true);
ย res.setHeader('Access-Control-Allow-Origin', '*');
ย res.setHeader('Access-Control-Allow-Methods', 'GET,OPTIONS,PATCH,DELETE,POST,PUT');
ย res.setHeader('Access-Control-Allow-Headers', 'Content-Type');

ย if (req.method === 'OPTIONS') {
ย ย res.status(200).end();
ย ย return;
ย }

ย if (req.method !== 'POST') {
ย ย return res.status(405).json({ error: 'Method not allowed' });
ย }

ย const { topic, style } = req.body;

ย if (!topic || !style) {
ย ย return res.status(400).json({ย
ย ย ย success: false,
ย ย ย error: 'ะะธะฟัะฒะฐ ัะตะผะฐ ะธะปะธ ััะธะป ะฝะฐ ะพะฑััะตะฝะธะต'ย
ย ย });
ย }

ย // Fallback ะดะตะผะพ ััะดััะถะฐะฝะธะต (ะฐะบะพ OpenAI ะฝะต ัะฐะฑะพัะธ)
ย const demoFallback = `
๐ฏ ะะฃะะก: ${topic}
๐ ะกะขะะ: ${style}

ะะะะะะะะ: "ะะตะทะตัะฒะตะฝ ะบััั ะฟะพ ${topic}"
ะะะะกะะะะ: OpenAI ััะปัะณะฐัะฐ ะฒัะตะผะตะฝะฝะพ ะฝะต ะต ะฝะฐะปะธัะฝะฐ. ะขะพะฒะฐ ะต ะฐะฒัะพะผะฐัะธัะฝะพ ะณะตะฝะตัะธัะฐะฝ ะบััั.

ะะะะฃะ 1: ะะกะะะะ
โข ะฃัะพะบ 1: ะัะฒะตะดะตะฝะธะต ะฒ ${topic}
โข ะฃัะพะบ 2: ะัะฝะพะฒะฝะธ ะฟัะธะฝัะธะฟะธ
โข ะฃัะพะบ 3: ะัะฐะบัะธัะตัะบะพ ัะฟัะฐะถะฝะตะฝะธะต

ะะะะฃะ 2: ะะะะจะะะะะ ะะะะะะฏ
โข ะฃัะพะบ 1: ะะฐะฟัะตะดะฝะฐะปะธ ัะตัะฝะธะบะธ
โข ะฃัะพะบ 2: ะะตะฐะปะฝะธ ะฟัะธะปะพะถะตะฝะธั
โข ะฃัะพะบ 3: ะคะธะฝะฐะปะตะฝ ะฟัะพะตะบั

โ๏ธ OpenAI ะธะฝัะตะณัะฐัะธััะฐ ะฒัะตะผะตะฝะฝะพ ะฝะต ะต ะฝะฐะปะธัะฝะฐ. ะะฐะฑะพัะธะผ ะฟะพ ัะตัะตะฝะธะตัะพ!
`;

ย try {
ย ย console.log('ะะทะฒะธะบะฒะฐะฝะต ะฝะฐ OpenAI ะทะฐ ัะตะผะฐ:', topic);

ย ย const completion = await openai.chat.completions.create({
ย ย ย model: "gpt-3.5-turbo",
ย ย ย messages: [
ย ย ย ย {
ย ย ย ย ย role: "system",
ย ย ย ย ย content: `ะขะธ ัะธ ะตะบัะฟะตัั ะฟะพ ะพะฑัะฐะทะพะฒะฐัะตะปะฝะธ ัะตัะฝะพะปะพะณะธะธ ะธ instructional design.
ย ย ย ย ย ะกัะทะดะฐะฒะฐั ะฒะธัะพะบะพะบะฐัะตััะฒะตะฝะธ ััะตะฑะฝะธ ะบัััะพะฒะต ะฝะฐ ะะชะะะะะกะะ ะตะทะธะบ.
ย ย ย ย ย ะัะผ ะฒัะตะบะธ ะบััั ะฒะบะปััะฒะฐั:
ย ย ย ย ย - ะะฐะณะปะฐะฒะธะต ะธ ะพะฟะธัะฐะฝะธะต
ย ย ย ย ย - 3-4 ะผะพะดัะปะฐ ั ััะฝะธ ััะตะฑะฝะธ ัะตะปะธ
ย ย ย ย ย - ะะพ 2-3 ััะพะบะฐ ะทะฐ ะฒัะตะบะธ ะผะพะดัะป ย
ย ย ย ย ย - ะัะฐะบัะธัะตัะบะธ ัะฟัะฐะถะฝะตะฝะธั
ย ย ย ย ย - ะะปััะพะฒะธ ะธะทะฒะพะดะธ

ย ย ย ย ย ะกัะธะปัั ัััะฑะฒะฐ ะดะฐ ะต ะผะพัะธะฒะธัะฐั, ะฟัะพัะตัะธะพะฝะฐะปะตะฝ ะธ ะปะตัะตะฝ ะทะฐ ัะฐะทะฑะธัะฐะฝะต.`
ย ย ย ย },
ย ย ย ย {
ย ย ย ย ย role: "user",
ย ย ย ย ย content: `ะกัะทะดะฐะน ะฟะพะดัะพะฑะตะฝ ััะตะฑะตะฝ ะบััั ะฝะฐ ะะชะะะะะกะะ ะตะทะธะบ ะฟะพ ัะตะผะฐ: "${topic}".

ย ย ย ย ย ะกัะธะป ะฝะฐ ะพะฑััะตะฝะธะต: ${style}

ย ย ย ย ย ะะฝััััะบัะธะธ ะทะฐ ััะธะปะฐ:
ย ย ย ย ย ${style === 'ะฟัะฐะบัะธัะตัะบะธ' ? 'ะคะพะบััะธัะฐะน ัะต ะฒัััั ัะฟัะฐะถะฝะตะฝะธั, ะฟัะฐะบัะธัะตัะบะธ ะทะฐะดะฐัะธ ะธ ัะตะฐะปะฝะธ ะฟัะธะปะพะถะตะฝะธั.' : ''}
ย ย ย ย ย ${style === 'ัะตะพัะตัะธัะตะฝ' ? 'ะะฐะฑะปะตะณะฝะธ ะฝะฐ ัะตะพัะธั, ะบะพะฝัะตะฟัะธะธ, ะฐะฝะฐะปะธะทะธ ะธ ััะฝะดะฐะผะตะฝัะฐะปะฝะธ ะฟัะธะฝัะธะฟะธ.' : ''}
ย ย ย ย ย ${style === 'ะธะฝัะตัะฐะบัะธะฒะตะฝ' ? 'ะะพะผะฑะธะฝะธัะฐะน ัะตะพัะธั ะธ ะฟัะฐะบัะธะบะฐ, ะฒะบะปััะฒะฐะน ะดะธัะบััะธะธ ะธ ะฒะทะฐะธะผะพะดะตะนััะฒะธั.' : ''}
ย ย ย ย ย ${style === 'ะบัะฐััะบ ะธ ััะตะฝ' ? 'ะัะดะธ ะดะธัะตะบัะตะฝ, ัะพะบััะธัะฐะฝ ะฒัััั ะฝะฐะน-ะฒะฐะถะฝะพัะพ, ะธะทะฑะตัะธะฒะฐะน ะฝะตะฝัะถะฝะธ ะฟะพะดัะพะฑะฝะพััะธ.' : ''}

ย ย ย ย ย ะกัััะบัััะฐ ะฝะฐ ะบัััะฐ:
ย ย ย ย ย 1. ะะะะะะะะ ะ ะะะะกะะะะ
ย ย ย ย ย 2. 3-4 ะะะะฃะะ ััั ะทะฐะณะปะฐะฒะธั
ย ย ย ย ย 3. ะะพ 2-3 ะฃะะะะ ะฒัะฒ ะฒัะตะบะธ ะผะพะดัะป
ย ย ย ย ย 4. ะะะะะขะะงะะกะะ ะฃะะะะะะะะะฏ
ย ย ย ย ย 5. ะะะฎะงะะะ ะะะะะะ

ย ย ย ย ย ะะตะฝะตัะธัะฐะน ััะดััะถะฐะฝะธะต, ะบะพะตัะพ ะต ะฟะพะปะตะทะฝะพ, ะฟัะธะปะพะถะธะผะพ ะธ engaging.`
ย ย ย ย }
ย ย ย ],
ย ย ย max_tokens: 1500,
ย ย ย temperature: 0.7,
ย ย });

ย ย const aiContent = completion.choices[0].message.content;

ย ย console.log('OpenAI ะพัะณะพะฒะพั ะฟะพะปััะตะฝ ััะฟะตัะฝะพ!');

ย ย res.status(200).json({
ย ย ย success: true,
ย ย ย course: aiContent,
ย ย ย note: "โ ะขะพะทะธ ะบััั ะต ะณะตะฝะตัะธัะฐะฝ ั ะธะทะบัััะฒะตะฝ ะธะฝัะตะปะตะบั!"
ย ย });

ย } catch (error) {
ย ย console.error('ะะะะจะะ ะฒ OpenAI:', error);

ย ย // ะัััะฐะผะต ะดะตะผะพ ะฒะตััะธั ะฟัะธ ะณัะตัะบะฐ
ย ย res.status(200).json({
ย ย ย success: true,
ย ย ย course: demoFallback,
ย ย ย note: "โ๏ธ ะัะตะผะตะฝะฝะฐ ะดะตะผะพ ะฒะตััะธั. AI ััะฝะบัะธะพะฝะฐะปะฝะพัััะฐ ัะต ะฒัะทััะฐะฝะพะฒัะฒะฐ."
ย ย });
ย }
}
