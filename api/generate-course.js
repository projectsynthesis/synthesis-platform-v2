// api/generate-course.js - Ð˜ÐÐ¢Ð•Ð›Ð˜Ð“Ð•ÐÐ¢ÐÐ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ Ð‘Ð•Ð— AI
console.log('=== ðŸ§  Ð˜ÐÐ¢Ð•Ð›Ð˜Ð“Ð•ÐÐ¢ÐÐ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ Ð—Ð ÐšÐ£Ð Ð¡ÐžÐ’Ð• ===');

// ÐŸÑ€ÐµÐ¼Ð°Ñ…Ð²Ð°Ð¼Ðµ Gemini Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸Ñ‚Ðµ - Ð½ÑÐ¼Ð°Ð¼Ðµ Ð½ÑƒÐ¶Ð´Ð° Ð¾Ñ‚ Ñ‚ÑÑ…!
console.log('ðŸ”§ Ð—Ð°Ñ€ÐµÐ¶Ð´Ð°Ð¼ Ð¸Ð½Ñ‚ÐµÐ»Ð¸Ð³ÐµÐ½Ñ‚Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð·Ð° Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° ÐºÑƒÑ€ÑÐ¾Ð²Ðµ...');

// Ð‘ÐÐ—Ð ÐžÐ¢ Ð—ÐÐÐÐ˜Ð¯ Ð—Ð Ð ÐÐ—Ð›Ð˜Ð§ÐÐ˜ Ð¢Ð•ÐœÐ˜
const TOPIC_TEMPLATES = {
  'Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¸Ñ€Ð°Ð½Ðµ': {
    modules: [
      'ÐžÑÐ½Ð¾Ð²Ð¸ Ð½Ð° ÑÐ¸Ð½Ñ‚Ð°ÐºÑÐ¸ÑÐ°',
      'ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð½Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð¸', 
      'Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð¸',
      'Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð´Ð°Ð½Ð½Ð¸',
      'ÐŸÑ€Ð¾ÐµÐºÑ‚Ð½Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°'
    ],
    lessons: [
      'Ð’ÑŠÐ²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð½Ð° ÑÑ€ÐµÐ´Ð°Ñ‚Ð°',
      'ÐŸÑ€Ð¾Ð¼ÐµÐ½Ð»Ð¸Ð²Ð¸ Ð¸ Ñ‚Ð¸Ð¿Ð¾Ð²Ðµ Ð´Ð°Ð½Ð½Ð¸',
      'Ð£ÑÐ»Ð¾Ð²Ð½Ð¸ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¸',
      'Ð¦Ð¸ÐºÐ»Ð¸ Ð¸ Ð¸Ñ‚ÐµÑ€Ð°Ñ†Ð¸Ð¸',
      'Ð¡ÑŠÐ·Ð´Ð°Ð²Ð°Ð½Ðµ Ð½Ð° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸',
      'Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¼Ð°ÑÐ¸Ð²Ð¸ Ð¸ Ð¾Ð±ÐµÐºÑ‚Ð¸',
      'Ð”ÐµÐ±ÑŠÐ³Ð²Ð°Ð½Ðµ Ð¸ Ð³Ñ€ÐµÑˆÐºÐ¸',
      'ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð½Ð° ÐºÐ¾Ð´Ð°'
    ]
  },
  'Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³': {
    modules: [
      'ÐžÑÐ½Ð¾Ð²Ð¸ Ð½Ð° Ð´Ð¸Ð³Ð¸Ñ‚Ð°Ð»Ð½Ð¸Ñ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³',
      'Ð¡ÑŠÐ·Ð´Ð°Ð²Ð°Ð½Ðµ Ð½Ð° ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ',
      'Ð¡ÑŠÐ´ÑŠÑ€Ð¶Ð°Ð½Ð¸Ðµ Ð¸ Ñ€ÐµÐºÐ»Ð°Ð¼Ð¸',
      'ÐÐ½Ð°Ð»Ð¸Ð· Ð¸ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ'
    ],
    lessons: [
      'Ð Ð°Ð·Ð±Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° Ñ†ÐµÐ»ÐµÐ²Ð°Ñ‚Ð° Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ',
      'SEO Ð¾Ð¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ',
      'Ð¡Ð¾Ñ†Ð¸Ð°Ð»Ð½Ð¸ Ð¼Ñ€ÐµÐ¶Ð¸',
      'Email Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³',
      'ÐŸÐ»Ð°Ñ‚Ð¸Ð¼Ð¸ Ñ€ÐµÐºÐ»Ð°Ð¼Ð¸',
      'ÐÐ½Ð°Ð»Ð¸Ð· Ð½Ð° Ð´Ð°Ð½Ð½Ð¸',
      'ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð½Ð° ÐºÐ°Ð¼Ð¿Ð°Ð½Ð¸Ð¸'
    ]
  },
  'Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÐµÐ¼Ð°Ñ‡ÐµÑÑ‚Ð²Ð¾': {
    modules: [
      'Ð˜Ð´ÐµÑ Ð¸ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ',
      'Ð‘Ð¸Ð·Ð½ÐµÑ Ð¿Ð»Ð°Ð½',
      'Ð¤Ð¸Ð½Ð°Ð½ÑÐ¸ Ð¸ Ð±ÑŽÐ´Ð¶ÐµÑ‚',
      'ÐœÐ°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³ Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð±Ð¸',
      'ÐœÐ°Ñ‰Ð°Ð±Ð¸Ñ€Ð°Ð½Ðµ'
    ],
    lessons: [
      'ÐÐ°Ð¼Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° Ð±Ð¸Ð·Ð½ÐµÑ Ð¸Ð´ÐµÑ',
      'ÐŸÑ€Ð¾ÑƒÑ‡Ð²Ð°Ð½Ðµ Ð½Ð° Ð¿Ð°Ð·Ð°Ñ€Ð°',
      'Ð¡ÑŠÐ·Ð´Ð°Ð²Ð°Ð½Ðµ Ð½Ð° Ð±Ð¸Ð·Ð½ÐµÑ Ð¼Ð¾Ð´ÐµÐ»',
      'Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð¾ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð°Ð½Ðµ',
      'Ð‘Ñ€Ð°Ð½Ð´Ð¸Ñ€Ð°Ð½Ðµ Ð¸ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¾Ð½Ð¸Ñ€Ð°Ð½Ðµ',
      'Ð”Ð¸Ð³Ð¸Ñ‚Ð°Ð»ÐµÐ½ Ð¼Ð°Ñ€ÐºÐµÑ‚Ð¸Ð½Ð³',
      'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð° ÐµÐºÐ¸Ð¿',
      'ÐœÐ°Ñ‰Ð°Ð±Ð¸Ñ€Ð°Ð½Ðµ Ð½Ð° Ð±Ð¸Ð·Ð½ÐµÑÐ°'
    ]
  },
  'Ñ„Ð¸Ð½Ð°Ð½ÑÐ¸': {
    modules: [
      'Ð›Ð¸Ñ‡Ð½Ð¸ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¸',
      'Ð˜Ð½Ð²ÐµÑÑ‚Ð¸Ñ€Ð°Ð½Ðµ',
      'Ð‘ÑŽÐ´Ð¶ÐµÑ‚Ð¸Ñ€Ð°Ð½Ðµ',
      'Ð¤Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð¾ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð°Ð½Ðµ'
    ],
    lessons: [
      'Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð° Ð´Ð¾Ñ…Ð¾Ð´Ð¸ Ð¸ Ñ€Ð°Ð·Ñ…Ð¾Ð´Ð¸',
      'Ð¡Ð¿ÐµÑÑ‚ÑÐ²Ð°Ð½Ð¸Ñ Ð¸ Ð¸Ð½Ð²ÐµÑÑ‚Ð¸Ñ†Ð¸Ð¸',
      'ÐÐºÑ†Ð¸Ð¸ Ð¸ Ð±Ð¾Ñ€ÑÐ¸',
      'ÐÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¸ Ð¸Ð¼Ð¾Ñ‚Ð¸',
      'ÐŸÐµÐ½ÑÐ¸Ð¾Ð½Ð½Ð¾ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð°Ð½Ðµ',
      'Ð”Ð°Ð½ÑŠÑ†Ð¸ Ð¸ Ð¾ÑÐ¸Ð³ÑƒÑ€Ð¾Ð²ÐºÐ¸'
    ]
  }
};

// Ð¡Ð¢Ð˜Ð›ÐžÐ’Ð• ÐÐ ÐžÐ‘Ð£Ð§Ð•ÐÐ˜Ð•
const LEARNING_STYLES = {
  'Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸': {
    description: 'Ð¤Ð¾ÐºÑƒÑÐ¸Ñ€Ð°Ð½ Ð²ÑŠÑ€Ñ…Ñƒ Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¸ Ñ€ÐµÐ°Ð»Ð½Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ',
    exercises: ['ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ', 'Ð ÐµÐ°Ð»ÐµÐ½ Ð¿Ñ€Ð¾ÐµÐºÑ‚', 'Case study', 'Ð¡Ð¸Ð¼ÑƒÐ»Ð°Ñ†Ð¸Ñ']
  },
  'Ñ‚ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡ÐµÐ½': {
    description: 'Ð—Ð°Ð´ÑŠÐ»Ð±Ð¾Ñ‡ÐµÐ½Ð¸ Ð¾Ð±ÑÑÐ½ÐµÐ½Ð¸Ñ Ð¸ ÐºÐ¾Ð½Ñ†ÐµÐ¿Ñ‚ÑƒÐ°Ð»Ð½Ð¾ Ñ€Ð°Ð·Ð±Ð¸Ñ€Ð°Ð½Ðµ', 
    exercises: ['ÐÐ½Ð°Ð»Ð¸Ð· Ð½Ð° ÐºÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ð¸', 'Ð¢ÐµÐ¾Ñ€ÐµÑ‚Ð¸Ñ‡Ð½Ð¾ Ð¸Ð·ÑÐ»ÐµÐ´Ð²Ð°Ð½Ðµ', 'Ð¡Ñ€Ð°Ð²Ð½Ð¸Ñ‚ÐµÐ»ÐµÐ½ Ð°Ð½Ð°Ð»Ð¸Ð·']
  },
  'Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½': {
    description: 'ÐšÐ¾Ð¼Ð±Ð¸Ð½Ð°Ñ†Ð¸Ñ Ð¾Ñ‚ Ñ‚ÐµÐ¾Ñ€Ð¸Ñ Ð¸ Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ° Ñ Ð¸Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¸ ÐµÐ»ÐµÐ¼ÐµÐ½Ñ‚Ð¸',
    exercises: ['Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ', 'Ð“Ñ€ÑƒÐ¿Ð¾Ð²Ð° Ð´Ð¸ÑÐºÑƒÑÐ¸Ñ', 'ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÐºÐµÐ¹Ñ']
  },
  'ÐºÑ€Ð°Ñ‚ÑŠÐº Ð¸ ÑÑÐµÐ½': {
    description: 'Ð”Ð¸Ñ€ÐµÐºÑ‚Ð½Ð¾ Ð¸ Ñ„Ð¾ÐºÑƒÑÐ¸Ñ€Ð°Ð½Ð¾ Ð²ÑŠÑ€Ñ…Ñƒ Ð½Ð°Ð¹-Ð²Ð°Ð¶Ð½Ð¾Ñ‚Ð¾',
    exercises: ['Ð‘ÑŠÑ€Ð·Ð° Ð·Ð°Ð´Ð°Ñ‡Ð°', 'Ð¤Ð¾ÐºÑƒÑÐ¸Ñ€Ð°Ð½Ð¾ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ', 'Ð•ÑÐµÐ½Ñ†Ð¸Ð°Ð»Ð½Ð° Ð¿Ñ€Ð°ÐºÑ‚Ð¸ÐºÐ°']
  }
};

// Ð¤Ð£ÐÐšÐ¦Ð˜Ð¯ Ð—Ð Ð˜ÐÐ¢Ð•Ð›Ð˜Ð“Ð•ÐÐ¢ÐÐž Ð“Ð•ÐÐ•Ð Ð˜Ð ÐÐÐ• ÐÐ ÐšÐ£Ð Ð¡
function generateIntelligentCourse(topic, style) {
  console.log(`ðŸ§  Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð¼ Ð¸Ð½Ñ‚ÐµÐ»Ð¸Ð³ÐµÐ½Ñ‚ÐµÐ½ ÐºÑƒÑ€Ñ Ð·Ð° "${topic}" ÑÑŠÑ ÑÑ‚Ð¸Ð» "${style}"`);
  
  // ÐÐ°Ð¼Ð¸Ñ€Ð°Ð¼Ðµ Ð½Ð°Ð¹-Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰Ð¸Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½
  const matchedTopic = findBestTopicMatch(topic);
  const styleConfig = LEARNING_STYLES[style] || LEARNING_STYLES['Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸'];
  
  // Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð¼Ðµ ÑƒÐ½Ð¸ÐºÐ°Ð»Ð½Ð¾ Ð·Ð°Ð³Ð»Ð°Ð²Ð¸Ðµ Ð¸ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ
  const title = generateCourseTitle(topic, style);
  const description = generateCourseDescription(topic, styleConfig.description);
  
  // Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð¼Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð¸ ÑƒÑ€Ð¾Ñ†Ð¸
  const modules = generateModules(matchedTopic, topic, style);
  
  return `ðŸŽ¯ ${title}
ðŸ“š Ð¡Ñ‚Ð¸Ð»: ${style} - ${styleConfig.description}

${description}

${modules}

ðŸ’¡ ÐšÐ»ÑŽÑ‡Ð¾Ð²Ð¸ Ð¸Ð·Ð²Ð¾Ð´Ð¸:
â€¢ ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð½Ð° Ð·Ð½Ð°Ð½Ð¸ÑÑ‚Ð°
â€¢ Ð¯ÑÐ½Ð¸ ÑÑ‚ÑŠÐ¿ÐºÐ¸ Ð·Ð° Ð½Ð°Ð¿Ñ€ÐµÐ´ÑŠÐº  
â€¢ ÐŸÐ¾Ð´Ñ…Ð¾Ð´ÑÑ‰ Ð·Ð° Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‰Ð¸ Ð¸ Ð½Ð°Ð¿Ñ€ÐµÐ´Ð½Ð°Ð»Ð¸

ðŸš€ Ð¢Ð¾Ð·Ð¸ ÐºÑƒÑ€Ñ Ðµ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð½ Ñ Ð½Ð°ÑˆÐ°Ñ‚Ð° Ð¸Ð½Ñ‚ÐµÐ»Ð¸Ð³ÐµÐ½Ñ‚Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð°!`;
}

// ÐŸÐžÐœÐÐ“ÐÐ©Ð˜ Ð¤Ð£ÐÐšÐ¦Ð˜Ð˜
function findBestTopicMatch(userTopic) {
  const userTopicLower = userTopic.toLowerCase();
  
  for (const [templateTopic, template] of Object.entries(TOPIC_TEMPLATES)) {
    if (userTopicLower.includes(templateTopic) || templateTopic.includes(userTopicLower)) {
      console.log(`âœ… ÐÐ°Ð¼ÐµÑ€ÐµÐ½ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð·Ð°: ${templateTopic}`);
      return template;
    }
  }
  
  // ÐÐºÐ¾ Ð½ÑÐ¼Ð° Ñ‚Ð¾Ñ‡Ð½Ð° ÑÑŠÐ²Ð¿Ð°Ð´Ð°Ñ‰Ð° Ñ‚ÐµÐ¼Ð°, Ð¸Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¼Ðµ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¸Ñ€Ð°Ð½ÐµÑ‚Ð¾ ÐºÐ°Ñ‚Ð¾ fallback
  console.log(`ðŸ”§ Ð˜Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¼ Ð¾Ð±Ñ‰ ÑˆÐ°Ð±Ð»Ð¾Ð½ Ð·Ð°: ${userTopic}`);
  return TOPIC_TEMPLATES['Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¸Ñ€Ð°Ð½Ðµ'];
}

function generateCourseTitle(topic, style) {
  const prefixes = ['ÐœÐ°ÑÑ‚ÐµÑ€ÑÐºÐ¸', 'ÐŸÑ€Ð¾Ñ„ÐµÑÐ¸Ð¾Ð½Ð°Ð»ÐµÐ½', 'Ð˜Ð·Ñ‡ÐµÑ€Ð¿Ð°Ñ‚ÐµÐ»ÐµÐ½', 'ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸', 'Ð˜Ð½Ñ‚ÐµÑ€Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½'];
  const suffixes = ['ÐºÑƒÑ€Ñ', 'Ð³Ð¸Ð´', 'Ð¿ÑŠÑ‚ÐµÐ²Ð¾Ð´Ð¸Ñ‚ÐµÐ»', 'ÑƒÑ€Ð¾ÐºÐ¸', 'Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸Ðµ'];
  
  const prefix = prefixes[Math.floor(Math.random() * prefixes.length)];
  const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];
  
  return `${prefix} ${suffix} Ð¿Ð¾ ${topic}`;
}

function generateCourseDescription(topic, styleDescription) {
  return `Ð¢Ð¾Ð·Ð¸ ${styleDescription.toLowerCase()} ÐºÑƒÑ€Ñ Ð¿Ð¾ ${topic} Ðµ ÑÑŠÐ·Ð´Ð°Ð´ÐµÐ½ Ð´Ð° Ñ‚Ðµ Ð½Ð°ÑƒÑ‡Ð¸ Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ð½Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð¸ Ð¸ Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑƒÐ¼ÐµÐ½Ð¸Ñ. ÐŸÐ¾Ð´Ñ…Ð¾Ð´ÑÑ‰ Ðµ ÐºÐ°ÐºÑ‚Ð¾ Ð·Ð° Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‰Ð¸, Ñ‚Ð°ÐºÐ° Ð¸ Ð·Ð° Ñ‚ÐµÐ·Ð¸, ÐºÐ¾Ð¸Ñ‚Ð¾ Ð¸ÑÐºÐ°Ñ‚ Ð´Ð° Ð·Ð°Ð´ÑŠÐ»Ð±Ð¾Ñ‡Ð°Ñ‚ Ð·Ð½Ð°Ð½Ð¸ÑÑ‚Ð° ÑÐ¸.`;
}

function generateModules(template, userTopic, style) {
  const styleConfig = LEARNING_STYLES[style] || LEARNING_STYLES['Ð¿Ñ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸'];
  let modulesText = '';
  
  // Ð˜Ð·Ð¿Ð¾Ð»Ð·Ð²Ð°Ð¼Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸Ñ‚Ðµ Ð¾Ñ‚ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ð¸Ð»Ð¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð¼Ðµ Ð½Ð¾Ð²Ð¸
  const modules = template.modules || ['ÐžÑÐ½Ð¾Ð²Ð¸', 'ÐÐ°Ð¿Ñ€ÐµÐ´Ð½Ð°Ð»Ð¸ Ñ‚ÐµÑ…Ð½Ð¸ÐºÐ¸', 'ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¾ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ'];
  
  modules.forEach((module, index) => {
    modulesText += `\nðŸ“‚ ÐœÐžÐ”Ð£Ð› ${index + 1}: ${module}\n`;
    
    // Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð¼Ðµ ÑƒÑ€Ð¾Ñ†Ð¸ Ð·Ð° Ð²ÑÐµÐºÐ¸ Ð¼Ð¾Ð´ÑƒÐ»
    const lessons = template.lessons || [
      'Ð’ÑŠÐ²ÐµÐ´ÐµÐ½Ð¸Ðµ Ð² Ñ‚ÐµÐ¼Ð°Ñ‚Ð°',
      'ÐžÑÐ½Ð¾Ð²Ð½Ð¸ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð¸', 
      'ÐŸÑ€Ð°ÐºÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ',
      'Ð£Ð¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ñ Ð¸ Ð·Ð°Ð´Ð°Ñ‡Ð¸'
    ];
    
    lessons.forEach((lesson, lessonIndex) => {
      if (lessonIndex < 3) { // ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ 3 ÑƒÑ€Ð¾ÐºÐ° Ð½Ð° Ð¼Ð¾Ð´ÑƒÐ»
        modulesText += `   âœ“ Ð£Ñ€Ð¾Ðº ${lessonIndex + 1}: ${lesson}\n`;
      }
    });
    
    // Ð”Ð¾Ð±Ð°Ð²ÑÐ¼Ðµ ÑƒÐ¿Ñ€Ð°Ð¶Ð½ÐµÐ½Ð¸Ðµ Ð² ÑÑ‚Ð¸Ð»Ð° Ð½Ð° Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð¸ÐµÑ‚Ð¾
    const exercise = styleConfig.exercises[Math.floor(Math.random() * styleConfig.exercises.length)];
    modulesText += `   ðŸŽ¯ ${exercise}: ÐŸÑ€Ð¸Ð»Ð¾Ð¶Ð¸ Ð½Ð°ÑƒÑ‡ÐµÐ½Ð¾Ñ‚Ð¾ Ð² Ñ€ÐµÐ°Ð»Ð½Ð° ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸Ñ\n`;
  });
  
  return modulesText;
}

module.exports = async function handler(req, res) {
  console.log('=== ðŸŒ Ð˜ÐÐ¢Ð•Ð›Ð˜Ð“Ð•ÐÐ¢ÐÐ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ - ÐÐžÐ’Ð Ð—ÐÐ¯Ð’ÐšÐ ===');
  
  // CORS headers
  res.setHeader('Access-Control-Allow-Origin', '*');
  res.setHeader('Access-Control-Allow-Methods', 'POST, OPTIONS');
  res.setHeader('Access-Control-Allow-Headers', 'Content-Type');

  if (req.method === 'OPTIONS') return res.status(200).end();
  if (req.method !== 'POST') return res.status(405).json({ error: 'Method not allowed' });

  try {
    const { topic, style } = req.body;
    console.log('ðŸ“ Ð—Ð°ÑÐ²ÐºÐ°:', { topic, style });

    if (!topic || !style) {
      return res.status(400).json({ 
        success: false,
        error: 'Ð¢ÐµÐ¼Ð° Ð¸ ÑÑ‚Ð¸Ð» ÑÐ° Ð·Ð°Ð´ÑŠÐ»Ð¶Ð¸Ñ‚ÐµÐ»Ð½Ð¸' 
      });
    }

    // Ð“Ð•ÐÐ•Ð Ð˜Ð ÐÐœÐ• Ð˜ÐÐ¢Ð•Ð›Ð˜Ð“Ð•ÐÐ¢Ð•Ð ÐšÐ£Ð Ð¡
    console.log('ðŸ§  Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð¼ Ð¸Ð½Ñ‚ÐµÐ»Ð¸Ð³ÐµÐ½Ñ‚ÐµÐ½ ÐºÑƒÑ€Ñ...');
    const intelligentCourse = generateIntelligentCourse(topic, style);
    
    console.log('âœ… Ð˜ÐÐ¢Ð•Ð›Ð˜Ð“Ð•ÐÐ¢Ð•Ð ÐšÐ£Ð Ð¡ Ð£Ð¡ÐŸÐ•Ð¨ÐÐž Ð“Ð•ÐÐ•Ð Ð˜Ð ÐÐ!');
    
    return res.status(200).json({
      success: true,
      course: intelligentCourse,
      note: "âœ… Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€Ð°Ð½Ð¾ Ñ Ð½Ð°ÑˆÐ°Ñ‚Ð° Ð¸Ð½Ñ‚ÐµÐ»Ð¸Ð³ÐµÐ½Ñ‚Ð½Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ð°!"
    });

  } catch (error) {
    console.error('ðŸ’¥ ÐÐµÐ¾Ñ‡Ð°ÐºÐ²Ð°Ð½Ð° Ð³Ñ€ÐµÑˆÐºÐ°:', error);
    
    return res.status(200).json({
      success: true,
      course: `ÐšÑƒÑ€Ñ Ð¿Ð¾ ${req.body?.topic || 'Ð½ÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ð° Ñ‚ÐµÐ¼Ð°'}. Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð° Ð³Ñ€ÐµÑˆÐºÐ°.`,
      note: "âš ï¸ Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð° Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ° Ð³Ñ€ÐµÑˆÐºÐ°"
    });
  }
};
